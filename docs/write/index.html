<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<title data-react-helmet="true">Writing data to Glean | Glean</title><meta data-react-helmet="true" property="og:url" content="https://glean.software/docs/write/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Writing data to Glean | Glean"><meta data-react-helmet="true" name="description" content="This page describes the various ways in which data gets into Glean."><meta data-react-helmet="true" property="og:description" content="This page describes the various ways in which data gets into Glean."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://glean.software/docs/write/"><link data-react-helmet="true" rel="alternate" href="https://glean.software/docs/write/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://glean.software/docs/write/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.822ed1dd.css">
<link rel="preload" href="/assets/js/runtime~main.f32362b1.js" as="script">
<link rel="preload" href="/assets/js/main.42e701f5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Glean</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><b class="navbar__title">Glean</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/introduction/">Documentation</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Quick Start</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/trying/">Trying Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/building/">Building Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/walkthrough/">Walkthrough</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">User Guide</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Schemas</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/basic/">Basic Concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/types/">Built-in Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/syntax/">Syntax</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/recursion/">Recursion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/changing/">Changing a schema</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/workflow/">Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/thrift/">Thrift and JSON</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Querying</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/query/intro/">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Angle</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/intro/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/guide/">Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/efficiency/">Query Efficiency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/advanced/">Advanced Query Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/debugging/">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/reference/">Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/style/">Style Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/query/api/haskell/">Haskell</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/derived/">Derived Predicates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/databases/">Glean Databases</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/write/">Writing data to Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/running/">Running the Tools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shell/">Using the Shell</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/">Running the Glean Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cli/">The Glean CLI tool</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Indexers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexer/intro/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexer/flow/">Javascript (Flow)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexer/hack/">Hack</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Writing data to Glean</h1></header><div class="markdown"><p>This page describes the various ways in which data gets into Glean.</p><p>There are two main methods for creating a DB. Repo-wide indexing jobs
which require multiple workers and have dependent tasks are managed by
the server, while simple one-off DB creation can be performed
independently by a single client.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="client-driven-writing"></a>Client-driven writing<a class="hash-link" href="#client-driven-writing" title="Direct link to heading">#</a></h2><p>A database can be created by a client using any of these methods:</p><ol><li>Programmatically, using one of the APIs listed in <a href="#apis-for-writing">APIs for Writing</a>.</li><li>On the command line: invoke the <code>glean</code> command-line tool to send data in JSON format, see <a href="#creating-a-database-usin"> Creating a database using the command line</a>.</li><li>In the shell, use <code>glean shell --db-root=&lt;dir&gt;</code> and then use the command <code>:load</code> to create a DB from a JSON file. See <a href="#loading-a-db-from-json-i"> Loading a DB from JSON in the shell</a>.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="server-driven-writing"></a>Server-driven writing<a class="hash-link" href="#server-driven-writing" title="Direct link to heading">#</a></h2><p>Large indexing jobs are coordinated by the server, using a <em>recipe</em> to
define the various tasks and the dependencies between them.  Recipes
are defined in the recipes configuration; see the <code>--recipe-config</code>
option in <a href="/docs/running/#common-options">Common options</a>.</p><p>The job proceeds as follows:</p><ul><li><p>An indexing job is started by calling the server&#x27;s <code>kickOff</code> Thrift
method. This creates a work queue of tasks on the server.</p></li><li><p>Clients obtain tasks from the server by calling <code>getWork</code>. Tasks may
have dependencies between them, so the server won&#x27;t hand out a task
until its dependencies are complete.</p></li><li><p>When all tasks are done, the server marks the database as complete.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="apis-for-writing"></a>APIs for writing<a class="hash-link" href="#apis-for-writing" title="Direct link to heading">#</a></h2><ul><li>The Haskell API for writing<ul><li>Example: <a href="https://github.com/facebookincubator/Glean/tree/master/glean/client/hs/example/ExampleWriter.hs">glean/client/hs/example/ExampleWriter.hs</a></li></ul></li></ul><p>If none of the above work for you, the Thrift API enable basic write
access to the database.</p><ul><li><code>kickOff</code> can be used to create a new DB</li><li><code>sendJsonBatch</code> is for sending facts in JSON-serialized form</li><li><code>finishBatch</code> exposes the result of a previously sent JSON batch</li><li><code>workFinished</code> closes a DB</li></ul><p>A rough outline of a client looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean = make_glean_thrift_client()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db_handle = make_uuid()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean.kickOff(my_repo, KickOffFill(writeHandle=db_handle))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for json_batch in json_batches:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    handle = glean.sendJsonBatch(json_batch)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    result = glean.finishBatch(handle)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # handle result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean.workFinished(my_repo, db_handle, success_or_failure)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="writing-from-the-command-line"></a>Writing from the command line<a class="hash-link" href="#writing-from-the-command-line" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="json-format"></a>JSON format<a class="hash-link" href="#json-format" title="Direct link to heading">#</a></h3><p>The JSON format for Glean data is described in <a href="/docs/schema/thrift/">Thrift and JSON</a>.</p><p>Here&#x27;s an example of JSON data for writing to Glean:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;predicate&quot;: &quot;cxx1.Name.1&quot;,          # define facts for cxx1.Name.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;facts&quot;: [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;id&quot;: 1, &quot;key&quot;: &quot;abc&quot; },         # define a fact with id 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;id&quot;: 2, &quot;key&quot;: &quot;def&quot; }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;predicate&quot;: &quot;cxx1.FunctionName.1&quot;,  # define facts for cxx1.FunctionName.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;facts&quot;: [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;id&quot;: 3,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;key&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot;: { &quot;id&quot;: 1 }}}          # reference to fact with id 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;predicate&quot;: &quot;cxx1.FunctionQName.1&quot;, # define facts for cxx1.FunctionQName.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;facts&quot;: [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;key&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: 3,                       # 3 is shorthand for { &quot;id&quot;: 3 }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;scope&quot;: { &quot;global_&quot;: {} } } },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;key&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;key&quot;: {                       # define a nested fact directly</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;key&quot;: &quot;ghi&quot; }}},         # another nested fact</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;scope&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;namespace_&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;key&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;name&quot;: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;key&quot;: &quot;std&quot; }}}}}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The rules of the game are:</p><ul><li>Predicate names must include versions, i.e. <code>cxx1.Name.1</code> rather than <code>cxx1.Name</code>.</li><li>The <code>id</code> field when defining a fact is optional. The <code>id</code> numbers in the input file will <em>not</em> be the final <code>id</code> numbers assigned to the facts in the database.</li><li>There are no restrictions on <code>id</code> values (any 64-bit integer will do) but an <code>id</code> value may not be reused within a file.</li><li>Later facts may refer to earlier ones using either <code>{ &quot;id&quot;: N }</code> or just <code>N</code>.</li><li>It is only possible to refer to <code>id</code>s from facts in the same file, if you are writing multiple files using <code>glean write</code> or via the <code>sendJsonBatch</code> API.</li><li>a nested facts can be defined inline, instead of defining it with an <code>id</code> first and then referencing it.</li><li>an inline nested fact can be given an <code>id</code> and referred to later.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="loading-a-db-from-json-in-the-shell"></a>Loading a DB from JSON in the shell<a class="hash-link" href="#loading-a-db-from-json-in-the-shell" title="Direct link to heading">#</a></h3><p>The shell is useful for experimenting with creating a DB from JSON data directly. Let&#x27;s try loading the data above into a DB in the shell:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ mkdir /tmp/glean</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ glean shell --db-root /tmp/glean</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Glean Shell, dev mode</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type :help for help.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">no fbsource database availabe</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; :load test/0 /home/smarlow/test</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">I0514 01:19:37.137109 3566745 Work.hs:184] test/16: database complete</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let&#x27;s see what facts we loaded:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">test&gt; :stat</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 72</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  5988</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.FunctionName.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  66</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.FunctionQName.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  70</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.Name.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 4</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  148</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.NamespaceQName.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  35</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that there were 4 <code>cxx1.Name.1</code> facts - some of those were defined as inline nested facts in the JSON. We can query them all:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">test&gt; cxx1.Name _</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4 results, 1 queries, 4 facts, 0.22ms, 44296 bytes</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1096, &quot;key&quot;: &quot;abc&quot; }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1097, &quot;key&quot;: &quot;def&quot; }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1100, &quot;key&quot;: &quot;ghi&quot; }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1102, &quot;key&quot;: &quot;std&quot; }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that the <code>id</code> values here do not correspond to the <code>id</code> values in the input file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-a-database-using-the-command-line"></a>Creating a database using the command line<a class="hash-link" href="#creating-a-database-using-the-command-line" title="Direct link to heading">#</a></h3><p>The <code>glean</code> command-line tool can be used to create a database directly on the server.</p><p>To create a database from a single file of JSON facts:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean create --service &lt;write-server&gt; --finish --repo &lt;name&gt;/&lt;hash&gt; &lt;filename&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>where</p><ul><li><code>&lt;write-server&gt;</code> is the <code>host:port</code> of the Glean server</li></ul><ul><li><code>&lt;name&gt;</code> is the name for your DB. For indexing repositories we normally use the name of the repository, but it&#x27;s just a string, so you can use whatever you want.</li><li><code>&lt;hash&gt;</code> identifies this particular instance of your database. For repositories we normally use the revision hash, but, again, it&#x27;s just a string.</li><li><code>&lt;filename&gt;</code> the file containing the JSON facts.</li></ul><p>If the file is more than, say, 100MB, this operation will probably time out sending the data to the server. To send large amounts of data you need to batch it up into multiple files, and then send it like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean create --service &lt;write-server&gt; --repo &lt;name&gt;/&lt;hash&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean write --service &lt;write-server&gt; --repo &lt;name&gt;/&lt;hash&gt; &lt;filename1&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean write --service &lt;write-server&gt; --repo &lt;name&gt;/&lt;hash&gt; &lt;filename2&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean finish --service &lt;write-server&gt; --repo &lt;name&gt;/&lt;hash&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To find out if your DB made it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">glean shell --service &lt;write-server&gt; :list</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will list the DBs available on the write server.</p><div></div><div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebookincubator/Glean/tree/main/glean/website/docs/write.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/databases/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Glean Databases</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/running/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Running the Tools Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#client-driven-writing" class="table-of-contents__link">Client-driven writing</a></li><li><a href="#server-driven-writing" class="table-of-contents__link">Server-driven writing</a></li><li><a href="#apis-for-writing" class="table-of-contents__link">APIs for writing</a></li><li><a href="#writing-from-the-command-line" class="table-of-contents__link">Writing from the command line</a><ul><li><a href="#json-format" class="table-of-contents__link">JSON format</a></li><li><a href="#loading-a-db-from-json-in-the-shell" class="table-of-contents__link">Loading a DB from JSON in the shell</a></li><li><a href="#creating-a-database-using-the-command-line" class="table-of-contents__link">Creating a database using the command line</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/MetaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f32362b1.js"></script>
<script src="/assets/js/main.42e701f5.js"></script>
</body>
</html>